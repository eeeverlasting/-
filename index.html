<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ„è®¯é˜…è¯»ç•Œé¢æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
        }
        .screen {
            background: white;
            border-radius: 15px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 100%;
            position: relative;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            width: 100%;
            margin: 10px 0;
        }
        .primary-btn {
            background: #4CAF50;
            color: white;
        }
        .primary-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .secondary-btn {
            background: #2196F3;
            color: white;
        }
        .secondary-btn:hover {
            background: #1976D2;
        }

        /* èµ„è®¯ç•Œé¢æ ·å¼ */
        .news-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
        }
        .news-header h1 {
            color: white;
            margin: 0;
            text-align: left;
            font-size: 24px;
        }
        .news-category {
            margin-top: 10px;
            font-size: 16px;
        }
        .news-content {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        .news-article {
            margin-bottom: 30px;
        }
        .news-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        .news-meta {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        .news-body {
            color: #34495e;
            line-height: 1.8;
        }
        .news-body p {
            margin-bottom: 15px;
        }

        /* ç‰ˆæœ¬Aï¼šæ™®é€šæ–‡å­—è¿”å›æç¤º */
        .version-a .return-text {
            color: #34495e;
            font-size: 14px;
            margin-bottom: 20px;
            padding: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid #ecf0f1;
        }
        .version-a .return-text:hover {
            color: #2c3e50;
            background-color: #f8f9fa;
        }

        /* ç‰ˆæœ¬Bï¼šå·¦ä¸Šè§’è¿”å›ç®­å¤´æŒ‰é’® */
        .version-b .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 5px;
            border: 1px solid #e0e0e0;
        }
        .version-b .back-button:hover {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }

        .progress {
            text-align: center;
            color: #666;
            margin: 20px 0;
            font-size: 14px;
        }
        #dataOutput {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            border: 1px solid #4CAF50;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        .task-instruction {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .instruction-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
        }
        .version-info {
            text-align: center;
            color: #666;
            margin: 10px 0;
            font-size: 14px;
        }

        /* æ¬¢è¿å±å¹•æ ·å¼ */
        .welcome-content {
            padding: 30px;
            text-align: left;
        }
    </style>
</head>
<body>
    <!-- æ¬¢è¿å±å¹• -->
    <div id="welcomeScreen" class="screen">
        <div class="welcome-content">
            <h1>ğŸ“° èµ„è®¯ç•Œé¢ç”¨æˆ·ä½“éªŒæµ‹è¯•</h1>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">æ„Ÿè°¢æ‚¨å‚ä¸æœ¬æ¬¡ç”¨æˆ·ä½“éªŒç ”ç©¶</p>

            <div style="margin-bottom: 30px;">
                <p><strong>å®éªŒè¯´æ˜ï¼š</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>æ‚¨å°†æµ‹è¯•<strong>2ç§ä¸åŒè¿”å›æ–¹å¼</strong>çš„èµ„è®¯ç•Œé¢è®¾è®¡</li>
                    <li>æ¯ä¸ªç‰ˆæœ¬åªéœ€è¦å®Œæˆ<strong>1ä¸ªç®€å•ä»»åŠ¡</strong></li>
                    <li>ç‰ˆæœ¬é¡ºåºæ˜¯<strong>éšæœºåˆ†é…</strong>çš„</li>
                    <li>è¯·<strong>å°½å¯èƒ½å¿«é€Ÿä¸”å‡†ç¡®</strong>åœ°æ‰¾åˆ°å¹¶ç‚¹å‡»è¿”å›æ–¹å¼</li>
                    <li>æ•´ä¸ªå®éªŒçº¦éœ€è¦2-3åˆ†é’Ÿ</li>
                    <li>æ‰€æœ‰æ•°æ®å°†åŒ¿åå¤„ç†ï¼Œä»…ç”¨äºå­¦æœ¯ç ”ç©¶</li>
                </ul>
            </div>

            <div style="margin-bottom: 20px;">
                <label for="participantId"><strong>å‚ä¸è€…ç¼–å·ï¼š</strong></label>
                <input type="text" id="participantId" placeholder="ä¾‹å¦‚ï¼šP01" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
            </div>

            <button class="primary-btn" onclick="startExperiment()">å¼€å§‹å®éªŒ</button>
        </div>
    </div>

    <!-- æŒ‡ä»¤å±å¹• -->
    <div id="instructionScreen" class="screen hidden">
        <div class="welcome-content">
            <h1>ä»»åŠ¡è¯´æ˜</h1>
            <div class="task-instruction">
                <div class="instruction-text">è¯·æ‰¾åˆ°å¹¶ç‚¹å‡»è¿”å›æ–¹å¼</div>
                <p style="color: #666; font-size: 14px;">è¯·ä»”ç»†è§‚å¯Ÿç•Œé¢ï¼Œæ‰¾åˆ°æ­£ç¡®çš„è¿”å›æ“ä½œ</p>
            </div>
            <div class="progress" id="progressInfo">ç‰ˆæœ¬ 1/2</div>
            <button class="secondary-btn" onclick="startTask()">æˆ‘å‡†å¤‡å¥½äº†ï¼Œå¼€å§‹ä»»åŠ¡</button>
        </div>
    </div>

    <!-- ä»»åŠ¡å±å¹• -->
    <div id="taskScreen" class="screen hidden version-a">
        <!-- èµ„è®¯å¤´éƒ¨ -->
        <div class="news-header">
            <h1># èµ„è®¯</h1>
            <div class="news-category">
                <strong>ç»¼åˆæ–°é—»</strong>
                <strong>æ´»åŠ¨çœ‹æ¿</strong>
            </div>
        </div>

        <!-- èµ„è®¯å†…å®¹ -->
        <div class="news-content">
            <div class="news-article">
                <!-- ç‰ˆæœ¬Aï¼šæ™®é€šæ–‡å­—è¿”å›æç¤º -->
                <div class="return-text" onclick="handleReturnClick()">
                    ç‚¹å‡»è¿”å›æ–°é—»ç»¼åˆåˆ—è¡¨
                </div>

                <h2 class="news-title" id="articleTitle">æ™ºæ…§å›¾ä¹¦é¦†å»ºè®¾æ–°è¿›å±•ï¼šäººå·¥æ™ºèƒ½åŠ©åŠ›çŸ¥è¯†æœåŠ¡å‡çº§</h2>

                <div class="news-meta">
                    <strong>å‘å¸ƒæ—¶é—´:</strong> 2024-11-20 &nbsp;&nbsp;
                    <strong>æµè§ˆæ¬¡æ•°:</strong> 128
                </div>

                <div class="news-body">
                    <p>åœ¨æ•°å­—åŒ–è½¬å‹çš„æµªæ½®ä¸­ï¼Œæˆ‘æ ¡å›¾ä¹¦é¦†ç§¯ææ¨è¿›æ™ºæ…§å›¾ä¹¦é¦†å»ºè®¾ï¼Œè¿‘æœŸå¼•å…¥äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œæ˜¾è‘—æå‡äº†çŸ¥è¯†æœåŠ¡çš„æ•ˆç‡å’Œè´¨é‡ã€‚</p>

                    <p>æ–°ç³»ç»Ÿé€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ï¼Œèƒ½å¤Ÿæ›´ç²¾å‡†åœ°ç†è§£ç”¨æˆ·çš„æ£€ç´¢éœ€æ±‚ï¼Œæä¾›ä¸ªæ€§åŒ–çš„æ–‡çŒ®æ¨èæœåŠ¡ã€‚åŒæ—¶ï¼Œæ™ºèƒ½é—®ç­”æœºå™¨äººçš„å¼•å…¥ï¼Œä¸ºè¯»è€…æä¾›äº†7Ã—24å°æ—¶ä¸é—´æ–­çš„å’¨è¯¢æœåŠ¡ã€‚</p>

                    <p>å›¾ä¹¦é¦†æŠ€æœ¯éƒ¨ä¸»ä»»è¡¨ç¤ºï¼š"äººå·¥æ™ºèƒ½æŠ€æœ¯çš„åº”ç”¨ï¼Œä¸ä»…æé«˜äº†æœåŠ¡æ•ˆç‡ï¼Œæ›´é‡è¦çš„æ˜¯èƒ½å¤Ÿæ·±å…¥æŒ–æ˜é¦†è—èµ„æºçš„ä»·å€¼ï¼Œä¸ºæ•™å­¦ç§‘ç ”æä¾›æ›´æœ‰åŠ›çš„æ”¯æŒã€‚"</p>

                    <p>ç›®å‰ï¼Œè¯¥ç³»ç»Ÿå·²è¦†ç›–å›¾ä¹¦é¦†çš„ä¸»è¦æœåŠ¡åœºæ™¯ï¼ŒåŒ…æ‹¬æ–‡çŒ®æ£€ç´¢ã€å‚è€ƒå’¨è¯¢ã€é˜…è¯»æ¨èç­‰ï¼Œè·å¾—äº†å¸ˆç”Ÿçš„å¹¿æ³›å¥½è¯„ã€‚</p>

                    <p>æœªæ¥ï¼Œå›¾ä¹¦é¦†è®¡åˆ’è¿›ä¸€æ­¥æ‹“å±•äººå·¥æ™ºèƒ½çš„åº”ç”¨èŒƒå›´ï¼Œæ¢ç´¢åœ¨çŸ¥è¯†å‘ç°ã€å­¦æœ¯åˆ†æç­‰é¢†åŸŸçš„æ·±åº¦åº”ç”¨ï¼Œä¸ºå»ºè®¾ä¸–ç•Œä¸€æµå¤§å­¦æä¾›æ›´ä¼˜è´¨çš„æ–‡çŒ®ä¿éšœæœåŠ¡ã€‚</p>
                </div>
            </div>
        </div>

        <!-- ç‰ˆæœ¬Bï¼šå·¦ä¸Šè§’è¿”å›ç®­å¤´æŒ‰é’® -->
        <div class="back-button" onclick="handleBackButtonClick()">
            <span>â—€</span> è¿”å›
        </div>

        <div class="version-info" id="versionInfo">å½“å‰ç‰ˆæœ¬ï¼šæ–‡å­—æç¤ºè¿”å›æ–¹å¼</div>
    </div>

    <!-- å®éªŒç»“æŸå±å¹• -->
    <div id="endScreen" class="screen hidden">
        <div class="welcome-content">
            <h1>âœ… æµ‹è¯•å®Œæˆï¼</h1>
            <p style="text-align: center; margin: 20px 0;">æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼æ‚¨çš„æ•°æ®å·²è®°å½•ã€‚</p>

            <div id="dataOutput"></div>

            <button class="primary-btn" onclick="downloadDataAsCSV()">ä¸‹è½½æ•°æ®CSVæ–‡ä»¶</button>
            <button class="secondary-btn" onclick="location.reload()" style="margin-top: 10px;">é‡æ–°å¼€å§‹ï¼ˆä¸‹ä¸€ä½å‚ä¸è€…ï¼‰</button>
        </div>
    </div>

    <script>
        // å®éªŒé…ç½®
        const experimentConfig = {
            versions: [
                {
                    id: 'A',
                    name: 'æ–‡å­—æç¤ºè¿”å›æ–¹å¼',
                    class: 'version-a',
                    description: 'é¡µé¢å†…å®¹åŒºä¸Šæ–¹æœ‰æ™®é€šæ–‡å­—"ç‚¹å‡»è¿”å›æ–°é—»ç»¼åˆåˆ—è¡¨"'
                },
                {
                    id: 'B',
                    name: 'å·¦ä¸Šè§’ç®­å¤´è¿”å›æ–¹å¼',
                    class: 'version-b',
                    description: 'é¡µé¢å·¦ä¸Šè§’æœ‰è¿”å›ç®­å¤´æŒ‰é’®"â—€ è¿”å›"'
                }
            ],
            articles: [
                {
                    title: 'æ™ºæ…§å›¾ä¹¦é¦†å»ºè®¾æ–°è¿›å±•ï¼šäººå·¥æ™ºèƒ½åŠ©åŠ›çŸ¥è¯†æœåŠ¡å‡çº§',
                    content: `åœ¨æ•°å­—åŒ–è½¬å‹çš„æµªæ½®ä¸­ï¼Œæˆ‘æ ¡å›¾ä¹¦é¦†ç§¯ææ¨è¿›æ™ºæ…§å›¾ä¹¦é¦†å»ºè®¾ï¼Œè¿‘æœŸå¼•å…¥äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œæ˜¾è‘—æå‡äº†çŸ¥è¯†æœåŠ¡çš„æ•ˆç‡å’Œè´¨é‡ã€‚

æ–°ç³»ç»Ÿé€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ï¼Œèƒ½å¤Ÿæ›´ç²¾å‡†åœ°ç†è§£ç”¨æˆ·çš„æ£€ç´¢éœ€æ±‚ï¼Œæä¾›ä¸ªæ€§åŒ–çš„æ–‡çŒ®æ¨èæœåŠ¡ã€‚åŒæ—¶ï¼Œæ™ºèƒ½é—®ç­”æœºå™¨äººçš„å¼•å…¥ï¼Œä¸ºè¯»è€…æä¾›äº†7Ã—24å°æ—¶ä¸é—´æ–­çš„å’¨è¯¢æœåŠ¡ã€‚

å›¾ä¹¦é¦†æŠ€æœ¯éƒ¨ä¸»ä»»è¡¨ç¤ºï¼š"äººå·¥æ™ºèƒ½æŠ€æœ¯çš„åº”ç”¨ï¼Œä¸ä»…æé«˜äº†æœåŠ¡æ•ˆç‡ï¼Œæ›´é‡è¦çš„æ˜¯èƒ½å¤Ÿæ·±å…¥æŒ–æ˜é¦†è—èµ„æºçš„ä»·å€¼ï¼Œä¸ºæ•™å­¦ç§‘ç ”æä¾›æ›´æœ‰åŠ›çš„æ”¯æŒã€‚"

ç›®å‰ï¼Œè¯¥ç³»ç»Ÿå·²è¦†ç›–å›¾ä¹¦é¦†çš„ä¸»è¦æœåŠ¡åœºæ™¯ï¼ŒåŒ…æ‹¬æ–‡çŒ®æ£€ç´¢ã€å‚è€ƒå’¨è¯¢ã€é˜…è¯»æ¨èç­‰ï¼Œè·å¾—äº†å¸ˆç”Ÿçš„å¹¿æ³›å¥½è¯„ã€‚`
                },
                {
                    title: 'æ•°å­—èµ„æºè®¿é—®é‡åˆ›æ–°é«˜ï¼šç”µå­æ–‡çŒ®æˆä¸ºå­¦æœ¯ç ”ç©¶ä¸»åŠ›',
                    content: `æ ¹æ®æœ€æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºï¼Œæœ¬å­¦æœŸæˆ‘æ ¡æ•°å­—èµ„æºè®¿é—®é‡è¾ƒå»å¹´åŒæœŸå¢é•¿45%ï¼Œç”µå­æ–‡çŒ®å·²æˆä¸ºå¸ˆç”Ÿå­¦æœ¯ç ”ç©¶çš„é¦–è¦é€‰æ‹©ã€‚

å›¾ä¹¦é¦†æ•°å­—èµ„æºä¸­å¿ƒä¸»ä»»ä»‹ç»ï¼Œè¿™ä¸€å¢é•¿å¾—ç›Šäºè¿‘å¹´æ¥åœ¨æ•°å­—èµ„æºå»ºè®¾æ–¹é¢çš„æŒç»­æŠ•å…¥ã€‚ç›®å‰ï¼Œå›¾ä¹¦é¦†å·²è®¢è´­ä¸­å¤–æ–‡æ•°æ®åº“286ä¸ªï¼Œç”µå­æœŸåˆŠ12ä¸‡ç§ï¼Œç”µå­å›¾ä¹¦240ä¸‡å†Œã€‚

"ç‰¹åˆ«æ˜¯ç–«æƒ…æœŸé—´ï¼Œæ•°å­—èµ„æºçš„é‡è¦æ€§æ›´åŠ å‡¸æ˜¾ã€‚"è¯¥ä¸»ä»»è¡¨ç¤ºï¼Œ"æˆ‘ä»¬ä¸ä»…ä¿éšœäº†èµ„æºçš„æ•°é‡ï¼Œæ›´é‡è¦çš„æ˜¯æå‡äº†æœåŠ¡çš„ä¾¿æ·æ€§ã€‚"

ä¸ºæ»¡è¶³å¸ˆç”Ÿå¤šæ ·åŒ–çš„éœ€æ±‚ï¼Œå›¾ä¹¦é¦†è¿˜æ¨å‡ºäº†ç§»åŠ¨å›¾ä¹¦é¦†APPï¼Œæ”¯æŒéšæ—¶éšåœ°è®¿é—®å­¦æœ¯èµ„æºï¼Œæå¤§æ–¹ä¾¿äº†å¸ˆç”Ÿçš„å­¦ä¹ å’Œç§‘ç ”å·¥ä½œã€‚`
                },
                {
                    title: 'å›¾ä¹¦é¦†å¼€å±•"ä¹¦é¦™æ ¡å›­"ç³»åˆ—æ´»åŠ¨ï¼Œè¥é€ æµ“åšé˜…è¯»æ°›å›´',
                    content: `ä¸ºä¸°å¯Œæ ¡å›­æ–‡åŒ–ç”Ÿæ´»ï¼ŒåŸ¹å…»å¸ˆç”Ÿé˜…è¯»ä¹ æƒ¯ï¼Œå›¾ä¹¦é¦†æœ¬å­¦æœŸå¯åŠ¨äº†"ä¹¦é¦™æ ¡å›­"ç³»åˆ—æ–‡åŒ–æ´»åŠ¨ï¼ŒåŒ…æ‹¬è¯»ä¹¦åˆ†äº«ä¼šã€åå®¶è®²åº§ã€å›¾ä¹¦æ¼‚æµç­‰å¤šé¡¹å†…å®¹ã€‚

æ´»åŠ¨é¦–åœºè¯»ä¹¦åˆ†äº«ä¼šé‚€è¯·äº†æ–‡å­¦é™¢æ•™æˆä¸åŒå­¦ä»¬å…±åŒæ¢è®¨ç»å…¸æ–‡å­¦ä½œå“ï¼Œç°åœºæ°”æ°›çƒ­çƒˆã€‚å‚ä¸å­¦ç”Ÿè¡¨ç¤ºï¼š"è¿™æ ·çš„æ´»åŠ¨ä¸ä»…è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°ç†è§£ä½œå“ï¼Œè¿˜ä¿ƒè¿›äº†åŒå­¦é—´çš„æ€æƒ³äº¤æµã€‚"

å›¾ä¹¦é¦†é˜…è¯»æ¨å¹¿éƒ¨è´Ÿè´£äººä»‹ç»ï¼Œåç»­è¿˜å°†ä¸¾åŠæ•°å­—èµ„æºåˆ©ç”¨åŸ¹è®­ã€å­¦æœ¯å†™ä½œæŒ‡å¯¼ç­‰å®ç”¨å‹æ´»åŠ¨ï¼Œå…¨æ–¹ä½æœåŠ¡å¸ˆç”Ÿçš„å­¦ä¹ å’Œç§‘ç ”éœ€æ±‚ã€‚

"æˆ‘ä»¬å¸Œæœ›æ‰“é€ ä¸€ä¸ªå……æ»¡ä¹¦é¦™æ°”æ¯çš„æ ¡å›­ç¯å¢ƒï¼Œè®©é˜…è¯»æˆä¸ºæ¯ä½å¸ˆç”Ÿç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ã€‚"è¯¥è´Ÿè´£äººè¡¨ç¤ºã€‚`
                }
            ],
            participantId: '',
            experimentData: [],
            currentVersionIndex: 0,
            versionOrder: [],
            taskStartTime: 0,
            currentArticleIndex: 0
        };

        // ç”Ÿæˆéšæœºé¡ºåº
        function generateRandomOrder() {
            const orders = [['A', 'B'], ['B', 'A']];
            return orders[Math.floor(Math.random() * orders.length)];
        }

        // å¼€å§‹æ•´ä¸ªå®éªŒ
        function startExperiment() {
            const participantId = document.getElementById('participantId').value.trim();
            if (!participantId) {
                alert('è¯·è¾“å…¥å‚ä¸è€…ç¼–å·ï¼');
                return;
            }

            experimentConfig.participantId = participantId;

            // ç”Ÿæˆéšæœºé¡ºåº
            experimentConfig.versionOrder = generateRandomOrder();
            console.log(`å‚ä¸è€… ${participantId} çš„é¡ºåº:`, experimentConfig.versionOrder);

            document.getElementById('welcomeScreen').classList.add('hidden');
            showInstruction();
        }

        // æ˜¾ç¤ºä»»åŠ¡æŒ‡ä»¤
        function showInstruction() {
            const currentVersionId = experimentConfig.versionOrder[experimentConfig.currentVersionIndex];
            const version = experimentConfig.versions.find(v => v.id === currentVersionId);

            document.getElementById('progressInfo').textContent =
                `ç‰ˆæœ¬ ${experimentConfig.currentVersionIndex + 1}/2`;

            document.getElementById('instructionScreen').classList.remove('hidden');
        }

        // å¼€å§‹å…·ä½“ä»»åŠ¡
        function startTask() {
            document.getElementById('instructionScreen').classList.add('hidden');

            // è®¾ç½®å½“å‰ç‰ˆæœ¬
            const currentVersionId = experimentConfig.versionOrder[experimentConfig.currentVersionIndex];
            const version = experimentConfig.versions.find(v => v.id === currentVersionId);

            const taskScreen = document.getElementById('taskScreen');
            taskScreen.className = 'screen ' + version.class;

            // æ ¹æ®ç‰ˆæœ¬æ˜¾ç¤º/éšè—å¯¹åº”çš„è¿”å›æ–¹å¼
            const returnText = taskScreen.querySelector('.return-text');
            const backButton = taskScreen.querySelector('.back-button');

            if (version.id === 'A') {
                returnText.style.display = 'block';
                backButton.style.display = 'none';
            } else {
                returnText.style.display = 'none';
                backButton.style.display = 'flex';
            }

            // éšæœºé€‰æ‹©ä¸€ç¯‡æ–‡ç« 
            experimentConfig.currentArticleIndex = Math.floor(Math.random() * experimentConfig.articles.length);
            const article = experimentConfig.articles[experimentConfig.currentArticleIndex];

            // æ›´æ–°æ–‡ç« å†…å®¹
            document.getElementById('articleTitle').textContent = article.title;

            // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
            document.getElementById('versionInfo').textContent = `å½“å‰ç‰ˆæœ¬ï¼š${version.name}`;

            // æ˜¾ç¤ºä»»åŠ¡ç•Œé¢
            taskScreen.classList.remove('hidden');

            // è®°å½•ä»»åŠ¡å¼€å§‹æ—¶é—´
            experimentConfig.taskStartTime = Date.now();
        }

        // å¤„ç†ç‰ˆæœ¬Açš„æ–‡å­—ç‚¹å‡»
        function handleReturnClick() {
            recordTaskCompletion();
        }

        // å¤„ç†ç‰ˆæœ¬Bçš„è¿”å›æŒ‰é’®ç‚¹å‡»
        function handleBackButtonClick() {
            recordTaskCompletion();
        }

        // è®°å½•ä»»åŠ¡å®Œæˆ
        function recordTaskCompletion() {
            const endTime = Date.now();
            const reactionTime = endTime - experimentConfig.taskStartTime;
            const currentVersionId = experimentConfig.versionOrder[experimentConfig.currentVersionIndex];
            const version = experimentConfig.versions.find(v => v.id === currentVersionId);

            // è®°å½•æ•°æ®
            const taskData = {
                participant: experimentConfig.participantId,
                version: version.id,
                versionName: version.name,
                versionOrder: experimentConfig.versionOrder.join('â†’'),
                taskOrder: experimentConfig.currentVersionIndex + 1,
                articleIndex: experimentConfig.currentArticleIndex,
                articleTitle: experimentConfig.articles[experimentConfig.currentArticleIndex].title,
                reactionTime: reactionTime,
                timestamp: new Date().toISOString()
            };

            experimentConfig.experimentData.push(taskData);
            console.log('ä»»åŠ¡å®Œæˆæ•°æ®:', taskData);

            // è¿›å…¥ä¸‹ä¸€ä¸ªç‰ˆæœ¬æˆ–ç»“æŸå®éªŒ
            experimentConfig.currentVersionIndex++;

            if (experimentConfig.currentVersionIndex < experimentConfig.versionOrder.length) {
                alert(`âœ… ä»»åŠ¡å®Œæˆï¼\nè€—æ—¶ï¼š${reactionTime}æ¯«ç§’\n\nç‚¹å‡»ç¡®å®šç»§ç»­ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚`);
                document.getElementById('taskScreen').classList.add('hidden');
                showInstruction();
            } else {
                alert(`âœ… æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼\næœ€åä¸€ä¸ªä»»åŠ¡è€—æ—¶ï¼š${reactionTime}æ¯«ç§’\n\næ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼`);
                endExperiment();
            }
        }

        // ç»“æŸå®éªŒ
        function endExperiment() {
            document.getElementById('taskScreen').classList.add('hidden');
            document.getElementById('endScreen').classList.remove('hidden');

            // æ˜¾ç¤ºæ”¶é›†åˆ°çš„æ•°æ®
            const allData = {
                participant: experimentConfig.participantId,
                versionOrder: experimentConfig.versionOrder,
                taskData: experimentConfig.experimentData,
                exportTime: new Date().toISOString()
            };

            document.getElementById('dataOutput').style.display = 'block';
            document.getElementById('dataOutput').textContent = 'å®éªŒæ•°æ®ï¼ˆå¯å¤åˆ¶ä¿å­˜ï¼‰ï¼š\n\n' + JSON.stringify(allData, null, 2);
        }

        // ä¸‹è½½æ•°æ®ä¸ºCSVæ–‡ä»¶
        function downloadDataAsCSV() {
            const headers = ['å‚ä¸è€…', 'ç‰ˆæœ¬', 'ç‰ˆæœ¬åç§°', 'ç‰ˆæœ¬é¡ºåº', 'ä»»åŠ¡é¡ºåº', 'æ–‡ç« ç¼–å·', 'æ–‡ç« æ ‡é¢˜', 'ååº”æ—¶é—´(ms)', 'æ—¶é—´æˆ³'];
            const csvContent = [
                headers.join(','),
                ...experimentConfig.experimentData.map(d => [
                    d.participant,
                    d.version,
                    `"${d.versionName}"`,
                    d.versionOrder,
                    d.taskOrder,
                    d.articleIndex,
                    `"${d.articleTitle}"`,
                    d.reactionTime,
                    d.timestamp
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `èµ„è®¯ç•Œé¢æµ‹è¯•æ•°æ®_${experimentConfig.participantId}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>

